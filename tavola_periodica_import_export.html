<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tavola Periodica – Import/Export + Animazioni</title>
<style>
:root{
  --bg:#f7f9fc; --ink:#102a43; --muted:#627d98; --card:#ffffff; --accent:#2b8a3e; --accent-2:#1f6feb;
  --border:#d9e2ec; --metallo:#e8f5e9; --nonmetallo:#e3f2fd; --semimetallo:#fff3e0; --alogeno:#f3e8ff; --nobile:#fce8ec;
  --alcalino:#fffde7; --alcalino-terroso:#f1f8e9; --transizione:#e0f7fa; --lantanide:#ede7f6; --attinide:#fbe9e7; --post:#f0f4f8;
  --highlight:#ffec99; --chonps:#ffe8a1; --shadow:0 8px 24px rgba(0,0,0,.08)
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg)}
header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#fff,rgba(255,255,255,.85));backdrop-filter:saturate(1.1) blur(6px);box-shadow:0 2px 12px rgba(0,0,0,.06)}
.container{max-width:1280px;margin:0 auto;padding:1rem}
.toolbar{display:flex;flex-wrap:wrap;gap:.75rem;align-items:center;justify-content:space-between}
.controls{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}
.controls input[type="search"]{padding:.65rem .8rem;border:1px solid var(--border);border-radius:10px;background:#fff;min-width:260px}
.btn{padding:.6rem .9rem;border:1px solid var(--border);border-radius:10px;background:#fff;color:var(--ink);cursor:pointer;transition:transform .05s ease, box-shadow .2s ease, background .2s ease}
.btn:hover{box-shadow:var(--shadow)}
.btn[aria-pressed="true"]{background:var(--accent);border-color:transparent;color:#fff}
select, .filters fieldset{padding:.45rem .6rem;border:1px solid var(--border);border-radius:10px;background:#fff}
.filters{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}
.legend{display:flex;flex-wrap:wrap;gap:.4rem .6rem}
.legend .chip{display:inline-flex;align-items:center;gap:.4rem;font-size:.8rem;padding:.2rem .5rem;border-radius:999px;border:1px solid var(--border);background:#fff}
.legend .sw{width:14px;height:14px;border-radius:4px;border:1px solid var(--border)}
main{padding:1rem}
.board{max-width:1280px;margin:0 auto;background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:1rem}
.grid{display:grid;grid-template-columns: repeat(18, minmax(42px, 1fr));grid-auto-rows:60px;gap:.35rem}
.cell{position:relative;border:1px solid var(--border);border-radius:10px;padding:.25rem .3rem;overflow:hidden;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;background:#fff;cursor:pointer;transition:transform .06s ease, box-shadow .2s ease, background .2s ease, filter .2s ease}
.cell .sym{font-weight:700;font-size:1.1rem;line-height:1}
.cell .z{position:absolute;top:.25rem;left:.35rem;font-size:.75rem;color:var(--muted)}
.cell .name{position:absolute;bottom:.3rem;left:.35rem;font-size:.7rem;color:var(--muted)}
.cell.chonps{outline:2px dashed #c97c00;background:var(--chonps)}
.cell.highlight{animation:pulse .9s ease-in-out 1}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,183,3,.6)}100%{box-shadow:0 0 0 18px rgba(255,183,3,0)}}
/* entrance animation for cells */
.cell{animation:popIn .35s ease var(--d,0ms) both}
@keyframes popIn{0%{opacity:0;transform:scale(.9)}100%{opacity:1;transform:scale(1)}}
.metallo{background:var(--metallo)} .nonmetallo{background:var(--nonmetallo)} .semimetallo{background:var(--semimetallo)}
.alogeno{background:var(--alogeno)} .nobile{background:var(--nobile)} .alcalino{background:var(--alcalino)} .alcalino-terroso{background:var(--alcalino-terroso)}
.transizione{background:var(--transizione)} .lantanide{background:var(--lantanide)} .attinide{background:var(--attinide)} .post{background:var(--post)}
.smallnote{font-size:.85rem;color:var(--muted);margin:.25rem 0}
/* Modal */
dialog#detail{border:none;border-radius:16px;max-width:900px;width:96vw;padding:0;box-shadow:0 24px 64px rgba(2,12,27,.25)}
.modal{display:grid;grid-template-columns: 1fr 1fr;gap:1rem;padding:1rem 1rem 1.25rem;background:#fff;border-radius:16px;transform-origin:50% 10%;animation:modalIn .22s ease-out both}
@keyframes modalIn{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
.modal header{grid-column:1/-1;background:transparent;box-shadow:none;position:static}
.modal .headline{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:.75rem}
.modal h2{margin:.25rem 0 0;font-size:1.35rem}
.meta{display:flex;gap:.5rem;flex-wrap:wrap;color:var(--muted);font-size:.9rem}
.kv{display:grid;grid-template-columns: 1fr 1fr;gap:.6rem}
.kv .row{display:grid;grid-template-columns: 1fr 1fr;gap:.4rem;padding:.35rem;border:1px solid var(--border);border-radius:10px;background:#fcfdff;opacity:0;transform:translateY(6px);animation:rowIn .28s ease-out forwards}
.kv .row:nth-child(1){animation-delay:60ms}.kv .row:nth-child(2){animation-delay:100ms}.kv .row:nth-child(3){animation-delay:140ms}.kv .row:nth-child(4){animation-delay:180ms}.kv .row:nth-child(5){animation-delay:220ms}.kv .row:nth-child(6){animation-delay:260ms}.kv .row:nth-child(7){animation-delay:300ms}.kv .row:nth-child(8){animation-delay:340ms}.kv .row:nth-child(9){animation-delay:380ms}.kv .row:nth-child(10){animation-delay:420ms}.kv .row:nth-child(11){animation-delay:460ms}.kv .row:nth-child(12){animation-delay:500ms}.kv .row:nth-child(13){animation-delay:540ms}.kv .row:nth-child(14){animation-delay:580ms}.kv .row:nth-child(15){animation-delay:620ms}
@keyframes rowIn{to{opacity:1;transform:translateY(0)}}
aside.note{grid-column:1/-1;border:1px dashed var(--border);background:#fff;padding:.75rem;border-radius:12px;color:#5c6b7a}
.modal .close{margin-left:auto;border:none;background:#efefef;border-radius:999px;padding:.45rem .65rem;cursor:pointer}
footer.modalbar{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:.9rem}
@media (max-width:700px){.modal{grid-template-columns:1fr}.kv{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <div class="container">
    <div class="toolbar">
      <div class="controls">
        <input id="search" type="search" placeholder="Cerca simbolo, nome o Z…" aria-label="Cerca elemento"/>
        <button class="btn" id="btnChonps" aria-pressed="false" title="Evidenzia CHONPS (C, H, O, N, P, S)">Evidenzia CHONPS</button>
        <button class="btn" id="btnAnim" title="Anima tutti">Anima tutti</button>
        <button class="btn" id="btnReset" title="Pulisci filtri">Reset</button>
      </div>
      <div class="filters">
        <label>Periodo
          <select id="fPeriod">
            <option value="">tutti</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option>
          </select>
        </label>
        <label>Blocco
          <select id="fBlock">
            <option value="">tutti</option><option value="s">s</option><option value="p">p</option><option value="d">d</option><option value="f">f</option>
          </select>
        </label>
        <label>Gruppo
          <select id="fGroup">
            <option value="">tutti</option>
            <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option><option>13</option><option>14</option><option>15</option><option>16</option><option>17</option><option>18</option>
          </select>
        </label>
        <fieldset style="display:flex;gap:.4rem;align-items:center">
          <legend style="font-size:.85rem;color:var(--muted)">Categoria</legend>
          <label><input type="checkbox" class="fCat" value="alcalino" checked/> Alcalini</label>
          <label><input type="checkbox" class="fCat" value="alcalino-terroso" checked/> Alcalino-terrosi</label>
          <label><input type="checkbox" class="fCat" value="transizione" checked/> Transizione</label>
          <label><input type="checkbox" class="fCat" value="post" checked/> Post-transizione</label>
          <label><input type="checkbox" class="fCat" value="semimetallo" checked/> Semimetalli</label>
          <label><input type="checkbox" class="fCat" value="nonmetallo" checked/> Non-metalli</label>
          <label><input type="checkbox" class="fCat" value="alogeno" checked/> Alogeni</label>
          <label><input type="checkbox" class="fCat" value="nobile" checked/> Nobili</label>
          <label><input type="checkbox" class="fCat" value="lantanide" checked/> Lantanidi</label>
          <label><input type="checkbox" class="fCat" value="attinide" checked/> Attinidi</label>
        </fieldset>
      </div>
    </div>
    <div class="container">
      <div class="legend">
        <span class="chip"><span class="sw" style="background:var(--alcalino)"></span> Alcalini</span>
        <span class="chip"><span class="sw" style="background:var(--alcalino-terroso)"></span> Alcalino-terrosi</span>
        <span class="chip"><span class="sw" style="background:var(--transizione)"></span> Transizione</span>
        <span class="chip"><span class="sw" style="background:var(--post)"></span> Post-transizione</span>
        <span class="chip"><span class="sw" style="background:var(--semimetallo)"></span> Semimetalli</span>
        <span class="chip"><span class="sw" style="background:var(--nonmetallo)"></span> Non-metalli</span>
        <span class="chip"><span class="sw" style="background:var(--alogeno)"></span> Alogeni</span>
        <span class="chip"><span class="sw" style="background:var(--nobile)"></span> Gas nobili</span>
        <span class="chip"><span class="sw" style="background:var(--lantanide)"></span> Lantanidi</span>
        <span class="chip"><span class="sw" style="background:var(--attinide)"></span> Attinidi</span>
        <span class="chip"><span class="sw" style="background:var(--chonps)"></span> CHONPS</span>
      </div>
      <div class="controls" style="margin-top:.5rem;gap:.5rem">
        <input id="file" type="file" accept="application/json,.json" style="display:none"/>
        <button class="btn" id="btnImport">Importa JSON</button>
        <button class="btn" id="btnExportHTML" title="Esporta un nuovo HTML con i dati incorporati">Esporta HTML</button>
        <button class="btn" id="btnExportJSON" title="Scarica il JSON attuale">Esporta JSON</button>
        <span id="status" class="smallnote" aria-live="polite"></span>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="board">
    <div class="grid" id="grid"></div>
    <p class="smallnote">Lantanidi (57–71) e Attinidi (89–103) sono disposti su righe dedicate.</p>
  </section>
</main>

<dialog id="detail">
  <div class="modal">
    <header>
      <div class="headline">
        <h2 id="d-title">Elemento</h2>
        <button class="close" id="d-close" aria-label="Chiudi">Chiudi ✕</button>
      </div>
      <div class="meta" id="d-meta"></div>
    </header>
    <div class="kv" id="d-kv"></div>
    <aside class="note" id="d-note">Nota: i dati mancanti sono indicati con “—”. Temperature in Kelvin (K) ove non diversamente specificato.</aside>
    <footer class="modalbar">
      <span id="d-pos"></span><span id="d-aux"></span>
    </footer>
  </div>
</dialog>

<!-- Se presente, questo script contiene dati incorporati da una precedente esportazione -->
<script id="EMBED_DATA" type="application/json">{}</script>

<script>
/* ===== Dataset base (struttura senza props: verrà riempito da EMBED o da JSON importato) ===== */
const ELEMENTS = [
  {
    "Z": 1,
    "sym": "H",
    "name": "Idrogeno",
    "period": 1,
    "group": 1,
    "block": "s",
    "category": "nonmetallo",
    "chonps": true,
    "props": {
      "atomic_mass": "",
      "phase": "",
      "appearance": "",
      "electron_configuration": "",
      "electronegativity_pauling": "",
      "atomic_radius": "",
      "covalent_radius_pm": "",
      "ionization_energy_kjmol": "",
      "oxidation_states": "",
      "density_gcm3": "",
      "melt": "",
      "boil": "",
      "discovered_by": "",
      "discovery_year": "",
      "uses": ""
    }
  },
  {
    "Z": 2,
    "sym": "He",
    "name": "Elio",
    "period": 1,
    "group": 18,
    "block": "s",
    "category": "nobile",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 3,
    "sym": "Li",
    "name": "Litio",
    "period": 2,
    "group": 1,
    "block": "s",
    "category": "alcalino",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 4,
    "sym": "Be",
    "name": "Berillio",
    "period": 2,
    "group": 2,
    "block": "s",
    "category": "alcalino-terroso",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 5,
    "sym": "B",
    "name": "Boro",
    "period": 2,
    "group": 13,
    "block": "p",
    "category": "semimetallo",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 6,
    "sym": "C",
    "name": "Carbonio",
    "period": 2,
    "group": 14,
    "block": "p",
    "category": "nonmetallo",
    "chonps": true,
    "props": {
      "atomic_mass": "",
      "phase": "",
      "appearance": "",
      "electron_configuration": "",
      "electronegativity_pauling": "",
      "atomic_radius": "",
      "covalent_radius_pm": "",
      "ionization_energy_kjmol": "",
      "oxidation_states": "",
      "density_gcm3": "",
      "melt": "",
      "boil": "",
      "discovered_by": "",
      "discovery_year": "",
      "uses": ""
    }
  },
  {
    "Z": 7,
    "sym": "N",
    "name": "Azoto",
    "period": 2,
    "group": 15,
    "block": "p",
    "category": "nonmetallo",
    "chonps": true,
    "props": {
      "atomic_mass": "",
      "phase": "",
      "appearance": "",
      "electron_configuration": "",
      "electronegativity_pauling": "",
      "atomic_radius": "",
      "covalent_radius_pm": "",
      "ionization_energy_kjmol": "",
      "oxidation_states": "",
      "density_gcm3": "",
      "melt": "",
      "boil": "",
      "discovered_by": "",
      "discovery_year": "",
      "uses": ""
    }
  },
  {
    "Z": 8,
    "sym": "O",
    "name": "Ossigeno",
    "period": 2,
    "group": 16,
    "block": "p",
    "category": "nonmetallo",
    "chonps": true,
    "props": {
      "atomic_mass": "",
      "phase": "",
      "appearance": "",
      "electron_configuration": "",
      "electronegativity_pauling": "",
      "atomic_radius": "",
      "covalent_radius_pm": "",
      "ionization_energy_kjmol": "",
      "oxidation_states": "",
      "density_gcm3": "",
      "melt": "",
      "boil": "",
      "discovered_by": "",
      "discovery_year": "",
      "uses": ""
    }
  },
  {
    "Z": 9,
    "sym": "F",
    "name": "Fluoro",
    "period": 2,
    "group": 17,
    "block": "p",
    "category": "alogeno",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 10,
    "sym": "Ne",
    "name": "Neon",
    "period": 2,
    "group": 18,
    "block": "p",
    "category": "nobile",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 11,
    "sym": "Na",
    "name": "Sodio",
    "period": 3,
    "group": 1,
    "block": "s",
    "category": "alcalino",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 12,
    "sym": "Mg",
    "name": "Magnesio",
    "period": 3,
    "group": 2,
    "block": "s",
    "category": "alcalino-terroso",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 13,
    "sym": "Al",
    "name": "Alluminio",
    "period": 3,
    "group": 13,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 14,
    "sym": "Si",
    "name": "Silicio",
    "period": 3,
    "group": 14,
    "block": "p",
    "category": "semimetallo",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 15,
    "sym": "P",
    "name": "Fosforo",
    "period": 3,
    "group": 15,
    "block": "p",
    "category": "nonmetallo",
    "chonps": true,
    "props": {
      "atomic_mass": "",
      "phase": "",
      "appearance": "",
      "electron_configuration": "",
      "electronegativity_pauling": "",
      "atomic_radius": "",
      "covalent_radius_pm": "",
      "ionization_energy_kjmol": "",
      "oxidation_states": "",
      "density_gcm3": "",
      "melt": "",
      "boil": "",
      "discovered_by": "",
      "discovery_year": "",
      "uses": ""
    }
  },
  {
    "Z": 16,
    "sym": "S",
    "name": "Zolfo",
    "period": 3,
    "group": 16,
    "block": "p",
    "category": "nonmetallo",
    "chonps": true,
    "props": {
      "atomic_mass": "",
      "phase": "",
      "appearance": "",
      "electron_configuration": "",
      "electronegativity_pauling": "",
      "atomic_radius": "",
      "covalent_radius_pm": "",
      "ionization_energy_kjmol": "",
      "oxidation_states": "",
      "density_gcm3": "",
      "melt": "",
      "boil": "",
      "discovered_by": "",
      "discovery_year": "",
      "uses": ""
    }
  },
  {
    "Z": 17,
    "sym": "Cl",
    "name": "Cloro",
    "period": 3,
    "group": 17,
    "block": "p",
    "category": "alogeno",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 18,
    "sym": "Ar",
    "name": "Argon",
    "period": 3,
    "group": 18,
    "block": "p",
    "category": "nobile",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 19,
    "sym": "K",
    "name": "Potassio",
    "period": 4,
    "group": 1,
    "block": "s",
    "category": "alcalino",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 20,
    "sym": "Ca",
    "name": "Calcio",
    "period": 4,
    "group": 2,
    "block": "s",
    "category": "alcalino-terroso",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 21,
    "sym": "Sc",
    "name": "Scandio",
    "period": 4,
    "group": 3,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 22,
    "sym": "Ti",
    "name": "Titanio",
    "period": 4,
    "group": 4,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 23,
    "sym": "V",
    "name": "Vanadio",
    "period": 4,
    "group": 5,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 24,
    "sym": "Cr",
    "name": "Cromo",
    "period": 4,
    "group": 6,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 25,
    "sym": "Mn",
    "name": "Manganese",
    "period": 4,
    "group": 7,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 26,
    "sym": "Fe",
    "name": "Ferro",
    "period": 4,
    "group": 8,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 27,
    "sym": "Co",
    "name": "Cobalto",
    "period": 4,
    "group": 9,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 28,
    "sym": "Ni",
    "name": "Nichel",
    "period": 4,
    "group": 10,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 29,
    "sym": "Cu",
    "name": "Rame",
    "period": 4,
    "group": 11,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 30,
    "sym": "Zn",
    "name": "Zinco",
    "period": 4,
    "group": 12,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 31,
    "sym": "Ga",
    "name": "Gallio",
    "period": 4,
    "group": 13,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 32,
    "sym": "Ge",
    "name": "Germanio",
    "period": 4,
    "group": 14,
    "block": "p",
    "category": "semimetallo",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 33,
    "sym": "As",
    "name": "Arsenico",
    "period": 4,
    "group": 15,
    "block": "p",
    "category": "semimetallo",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 34,
    "sym": "Se",
    "name": "Selenio",
    "period": 4,
    "group": 16,
    "block": "p",
    "category": "nonmetallo",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 35,
    "sym": "Br",
    "name": "Bromo",
    "period": 4,
    "group": 17,
    "block": "p",
    "category": "alogeno",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 36,
    "sym": "Kr",
    "name": "Kripton",
    "period": 4,
    "group": 18,
    "block": "p",
    "category": "nobile",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 37,
    "sym": "Rb",
    "name": "Rubidio",
    "period": 5,
    "group": 1,
    "block": "s",
    "category": "alcalino",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 38,
    "sym": "Sr",
    "name": "Stronzio",
    "period": 5,
    "group": 2,
    "block": "s",
    "category": "alcalino-terroso",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 39,
    "sym": "Y",
    "name": "Ittrio",
    "period": 5,
    "group": 3,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 40,
    "sym": "Zr",
    "name": "Zirconio",
    "period": 5,
    "group": 4,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 41,
    "sym": "Nb",
    "name": "Niobio",
    "period": 5,
    "group": 5,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 42,
    "sym": "Mo",
    "name": "Molibdeno",
    "period": 5,
    "group": 6,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 43,
    "sym": "Tc",
    "name": "Tecnezio",
    "period": 5,
    "group": 7,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 44,
    "sym": "Ru",
    "name": "Rutenio",
    "period": 5,
    "group": 8,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 45,
    "sym": "Rh",
    "name": "Rodio",
    "period": 5,
    "group": 9,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 46,
    "sym": "Pd",
    "name": "Palladio",
    "period": 5,
    "group": 10,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 47,
    "sym": "Ag",
    "name": "Argento",
    "period": 5,
    "group": 11,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 48,
    "sym": "Cd",
    "name": "Cadmio",
    "period": 5,
    "group": 12,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 49,
    "sym": "In",
    "name": "Indio",
    "period": 5,
    "group": 13,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 50,
    "sym": "Sn",
    "name": "Stagno",
    "period": 5,
    "group": 14,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 51,
    "sym": "Sb",
    "name": "Antimonio",
    "period": 5,
    "group": 15,
    "block": "p",
    "category": "semimetallo",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 52,
    "sym": "Te",
    "name": "Tellurio",
    "period": 5,
    "group": 16,
    "block": "p",
    "category": "semimetallo",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 53,
    "sym": "I",
    "name": "Iodio",
    "period": 5,
    "group": 17,
    "block": "p",
    "category": "alogeno",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 54,
    "sym": "Xe",
    "name": "Xenon",
    "period": 5,
    "group": 18,
    "block": "p",
    "category": "nobile",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 55,
    "sym": "Cs",
    "name": "Cesio",
    "period": 6,
    "group": 1,
    "block": "s",
    "category": "alcalino",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 56,
    "sym": "Ba",
    "name": "Bario",
    "period": 6,
    "group": 2,
    "block": "s",
    "category": "alcalino-terroso",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 57,
    "sym": "La",
    "name": "Lantanio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 58,
    "sym": "Ce",
    "name": "Cerio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 59,
    "sym": "Pr",
    "name": "Praseodimio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 60,
    "sym": "Nd",
    "name": "Neodimio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 61,
    "sym": "Pm",
    "name": "Promezio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 62,
    "sym": "Sm",
    "name": "Samario",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 63,
    "sym": "Eu",
    "name": "Europio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 64,
    "sym": "Gd",
    "name": "Gadolinio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 65,
    "sym": "Tb",
    "name": "Terbio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 66,
    "sym": "Dy",
    "name": "Disprosio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 67,
    "sym": "Ho",
    "name": "Olmio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 68,
    "sym": "Er",
    "name": "Erbio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 69,
    "sym": "Tm",
    "name": "Tulio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 70,
    "sym": "Yb",
    "name": "Itterbio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 71,
    "sym": "Lu",
    "name": "Lutezio",
    "period": 6,
    "group": 3,
    "block": "f",
    "category": "lantanide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 72,
    "sym": "Hf",
    "name": "Afnio",
    "period": 6,
    "group": 4,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 73,
    "sym": "Ta",
    "name": "Tantalio",
    "period": 6,
    "group": 5,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 74,
    "sym": "W",
    "name": "Tungsteno",
    "period": 6,
    "group": 6,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 75,
    "sym": "Re",
    "name": "Renio",
    "period": 6,
    "group": 7,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 76,
    "sym": "Os",
    "name": "Osmio",
    "period": 6,
    "group": 8,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 77,
    "sym": "Ir",
    "name": "Iridio",
    "period": 6,
    "group": 9,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 78,
    "sym": "Pt",
    "name": "Platino",
    "period": 6,
    "group": 10,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 79,
    "sym": "Au",
    "name": "Oro",
    "period": 6,
    "group": 11,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 80,
    "sym": "Hg",
    "name": "Mercurio",
    "period": 6,
    "group": 12,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 81,
    "sym": "Tl",
    "name": "Tallio",
    "period": 6,
    "group": 13,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 82,
    "sym": "Pb",
    "name": "Piombo",
    "period": 6,
    "group": 14,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 83,
    "sym": "Bi",
    "name": "Bismuto",
    "period": 6,
    "group": 15,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 84,
    "sym": "Po",
    "name": "Polonio",
    "period": 6,
    "group": 16,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 85,
    "sym": "At",
    "name": "Astato",
    "period": 6,
    "group": 17,
    "block": "p",
    "category": "alogeno",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 86,
    "sym": "Rn",
    "name": "Radon",
    "period": 6,
    "group": 18,
    "block": "p",
    "category": "nobile",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 87,
    "sym": "Fr",
    "name": "Francio",
    "period": 7,
    "group": 1,
    "block": "s",
    "category": "alcalino",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 88,
    "sym": "Ra",
    "name": "Radio",
    "period": 7,
    "group": 2,
    "block": "s",
    "category": "alcalino-terroso",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 89,
    "sym": "Ac",
    "name": "Attinio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 90,
    "sym": "Th",
    "name": "Torio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 91,
    "sym": "Pa",
    "name": "Protoattinio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 92,
    "sym": "U",
    "name": "Uranio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 93,
    "sym": "Np",
    "name": "Nettunio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 94,
    "sym": "Pu",
    "name": "Plutonio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 95,
    "sym": "Am",
    "name": "Americio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 96,
    "sym": "Cm",
    "name": "Curio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 97,
    "sym": "Bk",
    "name": "Berkelio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 98,
    "sym": "Cf",
    "name": "Californio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 99,
    "sym": "Es",
    "name": "Einsteinio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 100,
    "sym": "Fm",
    "name": "Fermio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 101,
    "sym": "Md",
    "name": "Mendelevio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 102,
    "sym": "No",
    "name": "Nobelio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 103,
    "sym": "Lr",
    "name": "Lawrencio",
    "period": 7,
    "group": 3,
    "block": "f",
    "category": "attinide",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 104,
    "sym": "Rf",
    "name": "Rutherfordio",
    "period": 7,
    "group": 4,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 105,
    "sym": "Db",
    "name": "Dubnio",
    "period": 7,
    "group": 5,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 106,
    "sym": "Sg",
    "name": "Seaborgio",
    "period": 7,
    "group": 6,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 107,
    "sym": "Bh",
    "name": "Bohrio",
    "period": 7,
    "group": 7,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 108,
    "sym": "Hs",
    "name": "Hassio",
    "period": 7,
    "group": 8,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 109,
    "sym": "Mt",
    "name": "Meitnerio",
    "period": 7,
    "group": 9,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 110,
    "sym": "Ds",
    "name": "Darmstadtio",
    "period": 7,
    "group": 10,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 111,
    "sym": "Rg",
    "name": "Roentgenio",
    "period": 7,
    "group": 11,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 112,
    "sym": "Cn",
    "name": "Copernicio",
    "period": 7,
    "group": 12,
    "block": "d",
    "category": "transizione",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 113,
    "sym": "Nh",
    "name": "Nihonio",
    "period": 7,
    "group": 13,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 114,
    "sym": "Fl",
    "name": "Flerovio",
    "period": 7,
    "group": 14,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 115,
    "sym": "Mc",
    "name": "Moscovio",
    "period": 7,
    "group": 15,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 116,
    "sym": "Lv",
    "name": "Livermorio",
    "period": 7,
    "group": 16,
    "block": "p",
    "category": "post",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 117,
    "sym": "Ts",
    "name": "Tennesso",
    "period": 7,
    "group": 17,
    "block": "p",
    "category": "alogeno",
    "chonps": false,
    "props": {}
  },
  {
    "Z": 118,
    "sym": "Og",
    "name": "Oganesson",
    "period": 7,
    "group": 18,
    "block": "p",
    "category": "nobile",
    "chonps": false,
    "props": {}
  }
];

/* ===== Sezione import/merge/export ===== */
const statusEl = document.getElementById('status');
const fileInput = document.getElementById('file');
document.getElementById('btnImport').addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', async (e)=>{
  const f = e.target.files[0]; if(!f) return;
  try{
    const text = await f.text();
    const parsed = JSON.parse(text);
    mergeData(parsed);
    statusEl.textContent = "JSON importato e unito ai dati.";
    animRipple();
    applyFilters();
  }catch(err){
    console.error(err); statusEl.textContent = "Errore nel parsing del JSON.";
  }finally{ fileInput.value=''; }
});

function mergeData(data){
  const arr = Array.isArray(data) ? data : (Array.isArray(data.elements)? data.elements : []);
  if(!arr.length){ statusEl.textContent = "Formato JSON non riconosciuto."; return; }
  const byZ = new Map(arr.map(el => [Number(el.Z||el.number), el]));
  for(const el of ELEMENTS){
    const src = byZ.get(el.Z);
    if(!src) continue;
    // Unisci proprietà note (name/sym/period/group/block/category/chonps) se presenti nel JSON
    ["name","sym","period","group","block","category","chonps"].forEach(k=>{
      if(src[k]!==undefined) el[k] = src[k];
    });
    // Unisci props
    el.props = Object.assign({}, el.props||{}, (src.props||{}));
  }
}

/* EMBED: se l'HTML contiene dati incorporati, applicali */
(() => {
  try{
    const embed = document.getElementById('EMBED_DATA');
    if(embed && embed.textContent.trim() && embed.textContent.trim() !== "{}"){
      const data = JSON.parse(embed.textContent);
      mergeData(data);
      statusEl.textContent = "Dati incorporati caricati.";
    }
  }catch{}
})();

/* ===== Export HTML/JSON ===== */
function download(name, content, type="text/plain"){
  const blob = new Blob([content], {type});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = name;
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href);
}
document.getElementById('btnExportJSON').addEventListener('click', ()=>{
  const out = JSON.stringify({elements: ELEMENTS}, null, 2);
  download("periodic_elements_export.json", out, "application/json");
});
document.getElementById('btnExportHTML').addEventListener('click', ()=>{
  const embed = JSON.stringify({elements: ELEMENTS});
  const tpl = document.documentElement.outerHTML.replace(
    /<script id="EMBED_DATA"[^>]*>[\s\S]*?<\/script>/,
    `<script id="EMBED_DATA" type="application/json">${embed.replace(/</g,"\\u003c")}</script>`
  );
  download("tavola_periodica_export.html", "<!DOCTYPE html>\\n" + tpl, "text/html");
  statusEl.textContent = "Nuovo HTML esportato con dati incorporati.";
});

/* ===== Posizionamento ===== */
const grid = document.getElementById('grid');
function positionFor(el){
  if(el.block==='f'){
    const baseRow = (el.period===6?9: (el.period===7?10:12));
    const index = (el.period===6 ? el.Z-57 : el.Z-89);
    return {col:4+index,row:baseRow};
  }
  return {col:el.group,row:el.period};
}
function catClass(c){
  return {'alcalino':'alcalino','alcalino-terroso':'alcalino-terroso','nobile':'nobile','alogeno':'alogeno',
          'semimetallo':'semimetallo','nonmetallo':'nonmetallo','post':'post','transizione':'transizione',
          'lantanide':'lantanide','attinide':'attinide'}[c]||'';
}

/* ===== Render + animazioni griglia ===== */
function render(){
  grid.innerHTML='';
  for(const el of ELEMENTS){
    const pos=positionFor(el);
    const btn=document.createElement('button');
    btn.className=\`cell \${catClass(el.category)} \${el.chonps?'chonps':''}\`.trim();
    btn.style.gridColumn=pos.col; btn.style.gridRow=pos.row;
    // ritardo d'entrata a gradiente per riga
    btn.style.setProperty('--d', (el.Z*8)+'ms');
    btn.dataset.z=el.Z; btn.dataset.group=el.group||''; btn.dataset.period=el.period||''; btn.dataset.block=el.block||''; btn.dataset.category=el.category||'';
    btn.title=\`\${el.name} (\${el.sym}) – Z \${el.Z}\`;
    btn.innerHTML=\`<span class="z">\${el.Z}</span><span class="sym">\${el.sym}</span><span class="name">\${el.name}</span>\`;
    btn.addEventListener('click',()=>openDetail(el));
    grid.appendChild(btn);
  }
}
render();

/* ===== Filtri ===== */
const q=document.getElementById('search'), fPeriod=document.getElementById('fPeriod'), fGroup=document.getElementById('fGroup'), fBlock=document.getElementById('fBlock');
const fCats=Array.from(document.querySelectorAll('.fCat'));
function applyFilters(){
  const term=q.value.trim().toLowerCase(), p=fPeriod.value, g=fGroup.value, b=fBlock.value;
  const allowed=new Set(fCats.filter(c=>c.checked).map(c=>c.value));
  const cells=grid.querySelectorAll('.cell');
  for(const c of cells){
    const el=ELEMENTS.find(x=>x.Z===+c.dataset.z);
    const hay=[el.sym,el.name,String(el.Z)].join(' ').toLowerCase();
    const ok=(!term||hay.includes(term)) && (!p||String(el.period)===p) && (!g||String(el.group)===g) && (!b||el.block===b) && allowed.has(el.category);
    c.style.display=ok?'':'none';
    c.style.filter=(term && !hay.includes(term))?'grayscale(0.9) opacity(.45)':'';
    c.style.outline=(term && hay.includes(term))?'2px solid var(--accent-2)':'';
  }
}
[q,fPeriod,fGroup,fBlock].forEach(inp=>inp.addEventListener('input',applyFilters));
fCats.forEach(cb=>cb.addEventListener('change',applyFilters));
document.getElementById('btnReset').addEventListener('click',()=>{
  q.value=''; fPeriod.value=''; fGroup.value=''; fBlock.value=''; fCats.forEach(c=>c.checked=true);
  document.getElementById('btnChonps').setAttribute('aria-pressed','false'); toggleChonps(false); applyFilters();
});

/* ===== CHONPS ===== */
const btnChonps=document.getElementById('btnChonps');
btnChonps.addEventListener('click',()=>{
  const on=btnChonps.getAttribute('aria-pressed')!=='true';
  btnChonps.setAttribute('aria-pressed',String(on)); toggleChonps(on);
});
function toggleChonps(on){
  grid.querySelectorAll('.cell').forEach(c=>{
    const el=ELEMENTS.find(x=>x.Z===+c.dataset.z);
    if(el?.chonps){ c.classList.toggle('highlight',on); c.style.transform=on?'translateY(-1px) scale(1.02)':''; }
  });
}

/* ===== Animazione “onda” ===== */
function animRipple(){
  const cells=Array.from(grid.querySelectorAll('.cell')).sort((a,b)=>(+a.dataset.z)-(+b.dataset.z));
  let i=0; for(const c of cells){ setTimeout(()=>{ c.classList.add('highlight'); setTimeout(()=>c.classList.remove('highlight'),650); },45*i++); }
}
document.getElementById('btnAnim').addEventListener('click', animRipple);

/* ===== Modal con animazioni delle righe ===== */
const dlg=document.getElementById('detail'), dTitle=document.getElementById('d-title'), dMeta=document.getElementById('d-meta'), dKV=document.getElementById('d-kv'), dPos=document.getElementById('d-pos'), dAux=document.getElementById('d-aux');
function V(x){ return (x===undefined||x===null||x===''||x==='—')?'—':x; }
function row(key,val){ const r=document.createElement('div'); r.className='row'; r.innerHTML=`<div class="key">${key}</div><div class="val">${V(val)}</div>`; return r; }
function catLabel(c){
  return {"alcalino":"Metallo alcalino","alcalino-terroso":"Metallo alcalino-terroso","nonmetallo":"Non-metallo","semimetallo":"Semimetallo","alogeno":"Alogeno","nobile":"Gas nobile","post":"Metallo post-transizione","transizione":"Metallo di transizione","lantanide":"Lantanide","attinide":"Attinide"}[c]||"—";
}
function openDetail(el){
  dTitle.textContent=`${el.name} (${el.sym})`; dMeta.innerHTML=`Z ${el.Z} • Gruppo ${V(el.group)} • Periodo ${V(el.period)} • Blocco ${V(el.block)}`;
  dKV.innerHTML='';
  const P=el.props||{};
  const fields=[
    ["Categoria",catLabel(el.category)],
    ["Massa atomica (u)",P.atomic_mass],
    ["Stato standard",P.phase||P.state],
    ["Aspetto",P.appearance],
    ["Configurazione elettronica",P.electron_configuration||P.electronConfig],
    ["Elettronegatività (Pauling)",P.electronegativity_pauling||P.electronegativity],
    ["Raggio atomico (pm)",P.atomic_radius||P.radius],
    ["R. covalente (pm)",P.covalent_radius_pm],
    ["Energia 1ª ionizzazione (kJ/mol)",P.ionization_energy_kjmol||P.ionization],
    ["Stati di ossidazione",P.oxidation_states||P.oxidation],
    ["Densità (g/cm³)",P.density_gcm3||P.density],
    ["Punto di fusione (K)",P.melt||P.melting_k],
    ["Punto di ebollizione (K)",P.boil||P.boiling_k],
    ["Scopritore",P.discovered_by||P.discoveredBy],
    ["Anno di scoperta",P.discovery_year||P.year],
    ["Impieghi chiave",P.uses]
  ];
  for(const [k,v] of fields) dKV.appendChild(row(k,v));
  const pos=positionFor(el);
  dPos.textContent=`Posizione: gruppo ${V(el.group)}, periodo ${V(el.period)} (col ${pos.col}, riga ${pos.row}).`;
  dAux.textContent=el.chonps?"Appartiene al gruppo didattico CHONPS.":"";
  if(typeof dlg.showModal==='function'){ dlg.showModal(); } else { dlg.setAttribute('open',''); }
}
document.getElementById('d-close').addEventListener('click',()=>dlg.close());
dlg.addEventListener('click',(e)=>{ const rect=dlg.querySelector('.modal')?.getBoundingClientRect(); if(!rect) return; const x=e.clientX,y=e.clientY; if(x<rect.left||x>rect.right||y<rect.top||y>rect.bottom) dlg.close(); });

/* ===== Inizializza filtri ===== */
applyFilters();
</script>
</body>
</html>
