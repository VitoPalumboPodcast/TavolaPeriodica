<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz di Chimica Multilivello</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #f4f6fb;
        --card: #ffffff;
        --text: #1e293b;
        --muted: #475569;
        --accent: #2563eb;
        --accent-soft: #e0e7ff;
        --border: rgba(15, 23, 42, 0.12);
        --option-bg: #f8fafc;
        --option-border: rgba(100, 116, 139, 0.35);
        --correct-bg: #d1fae5;
        --correct-border: #34d399;
        --correct-text: #065f46;
        --wrong-bg: #fee2e2;
        --wrong-border: #f87171;
        --wrong-text: #7f1d1d;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(180deg, #eef2ff 0%, #f8fafc 30%, #ffffff 100%);
        color: var(--text);
        display: flex;
        justify-content: center;
        padding: clamp(20px, 5vw, 60px);
      }

      .app {
        width: min(1040px, 100%);
        background: var(--card);
        border-radius: 28px;
        box-shadow: 0 30px 80px rgba(15, 23, 42, 0.12);
        padding: clamp(24px, 5vw, 48px);
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      header {
        text-align: center;
        display: grid;
        gap: 12px;
      }

      h1 {
        margin: 0;
        font-size: clamp(2rem, 4vw, 2.75rem);
        letter-spacing: -0.02em;
      }

      p.lead {
        margin: 0;
        font-size: clamp(1rem, 2.5vw, 1.2rem);
        color: var(--muted);
      }

      .difficulty-panel {
        display: grid;
        gap: 18px;
      }

      .difficulty-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
      }

      .difficulty-buttons button {
        border: 2px solid transparent;
        border-radius: 16px;
        padding: 16px 18px;
        background: var(--accent-soft);
        color: var(--accent);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, border-color 0.2s ease;
      }

      .difficulty-buttons button:hover,
      .difficulty-buttons button:focus-visible {
        outline: none;
        transform: translateY(-2px);
        box-shadow: 0 18px 30px rgba(37, 99, 235, 0.2);
        border-color: var(--accent);
      }

      .difficulty-buttons button.active {
        background: var(--accent);
        color: white;
        box-shadow: 0 20px 40px rgba(37, 99, 235, 0.35);
      }

      .quiz-card {
        border: 1px solid var(--border);
        border-radius: 24px;
        padding: clamp(20px, 4vw, 36px);
        background: linear-gradient(140deg, #ffffff 0%, #f3f4ff 100%);
        display: grid;
        gap: 20px;
      }

      .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px 20px;
        justify-content: space-between;
        color: var(--muted);
        font-weight: 600;
      }

      .question-text {
        font-size: clamp(1.1rem, 2.5vw, 1.4rem);
        line-height: 1.5;
      }

      .options {
        display: grid;
        gap: 12px;
      }

      .option {
        border: 2px solid var(--option-border);
        border-radius: 14px;
        padding: 14px 16px;
        background: var(--option-bg);
        color: var(--text);
        font-size: 1rem;
        text-align: left;
        cursor: pointer;
        transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease, background 0.18s ease;
      }

      .option span {
        font-weight: 700;
        margin-right: 8px;
        color: var(--muted);
      }

      .option:hover,
      .option:focus-visible {
        outline: none;
        transform: translateY(-1px);
        box-shadow: 0 14px 30px rgba(15, 23, 42, 0.12);
        border-color: var(--accent);
      }

      .option.correct {
        background: var(--correct-bg);
        border-color: var(--correct-border);
        color: var(--correct-text);
      }

      .option.correct span {
        color: var(--correct-text);
      }

      .option.wrong {
        background: var(--wrong-bg);
        border-color: var(--wrong-border);
        color: var(--wrong-text);
      }

      .option.wrong span {
        color: var(--wrong-text);
      }

      .option[disabled] {
        cursor: default;
        opacity: 0.96;
        box-shadow: none;
        transform: none;
      }

      .feedback {
        border-radius: 14px;
        padding: 16px 18px;
        border: 1px solid var(--border);
        background: rgba(148, 163, 184, 0.15);
        color: var(--muted);
        display: none;
        line-height: 1.5;
      }

      .feedback.visible {
        display: block;
      }

      .feedback.positive {
        border-color: rgba(34, 197, 94, 0.4);
        background: rgba(187, 247, 208, 0.45);
        color: #166534;
      }

      .feedback.negative {
        border-color: rgba(248, 113, 113, 0.45);
        background: rgba(254, 202, 202, 0.45);
        color: #7f1d1d;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: space-between;
        align-items: center;
      }

      .controls button {
        border: none;
        border-radius: 14px;
        padding: 12px 20px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
      }

      .controls button.primary {
        background: var(--accent);
        color: white;
        box-shadow: 0 16px 40px rgba(37, 99, 235, 0.25);
      }

      .controls button.primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        box-shadow: none;
      }

      .controls button.secondary {
        background: var(--accent-soft);
        color: var(--accent);
      }

      .controls button:hover:not(:disabled),
      .controls button:focus-visible:not(:disabled) {
        outline: none;
        transform: translateY(-1px);
        box-shadow: 0 18px 40px rgba(37, 99, 235, 0.2);
      }

      .score-panel {
        border-radius: 22px;
        padding: clamp(20px, 4vw, 36px);
        background: linear-gradient(160deg, rgba(37, 99, 235, 0.1), rgba(59, 130, 246, 0.05));
        border: 1px solid rgba(37, 99, 235, 0.2);
        display: grid;
        gap: 12px;
      }

      .score-panel h2 {
        margin: 0;
        font-size: clamp(1.4rem, 3vw, 1.7rem);
      }

      .score-details {
        display: grid;
        gap: 8px;
        color: var(--muted);
      }

      .hidden {
        display: none !important;
      }

      @media (max-width: 720px) {
        body {
          padding: 16px;
        }

        .app {
          border-radius: 18px;
          padding: 20px;
        }

        .quiz-card {
          border-radius: 18px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header>
        <h1>Quiz di Chimica Multilivello</h1>
        <p class="lead">
          Scegli il livello di difficoltà, rispondi alle domande e ricevi subito il feedback con spiegazione dettagliata.
        </p>
      </header>

      <section class="difficulty-panel">
        <h2>1. Scegli il livello</h2>
        <div class="difficulty-buttons" role="group" aria-label="Selezione livello">
          <button type="button" data-level="base">Livello Base</button>
          <button type="button" data-level="easy">Super Facile</button>
          <button type="button" data-level="medium">Medio</button>
          <button type="button" data-level="hard">Difficile</button>
        </div>
      </section>

      <section class="quiz-card hidden" id="quizCard" aria-live="polite">
        <div class="meta">
          <span id="questionCounter"></span>
          <span id="scoreCounter"></span>
        </div>
        <div class="question-text" id="questionText"></div>
        <div class="options" id="options" role="list"></div>
        <div class="feedback" id="feedback"></div>
        <div class="controls">
          <button type="button" class="secondary" id="resetButton">Cambia livello</button>
          <button type="button" class="primary" id="nextButton" disabled>Avanti</button>
        </div>
      </section>

      <section class="score-panel hidden" id="scorePanel">
        <h2>Risultato finale</h2>
        <div class="score-details">
          <p id="finalScore"></p>
          <p id="finalAccuracy"></p>
          <p id="finalSummary"></p>
        </div>
        <div class="controls">
          <button type="button" class="primary" id="restartButton">Riprova lo stesso livello</button>
          <button type="button" class="secondary" id="chooseButton">Scegli un altro livello</button>
        </div>
      </section>
    </div>

    <script>
      const questionBank = {
        base: [
          {
            question: "Qual è il criterio fondamentale per distinguere un Miscuglio da una Sostanza Pura?",
            answers: [
              { label: "A", text: "Se può essere scomposta mediante reazioni chimiche", correct: false },
              { label: "B", text: "Se possiede massa e occupa un volume", correct: false },
              { label: "C", text: "Se può essere scomposta mediante metodi fisici", correct: true },
              { label: "D", text: "Se i suoi componenti sono visibilmente distinguibili", correct: false }
            ],
            explanation:
              "Un miscuglio può essere separato in componenti più semplici tramite metodi fisici, a differenza di una sostanza pura."
          },
          {
            question: "Cosa rappresenta il Numero Atomico (Z) di un elemento chimico?",
            answers: [
              { label: "A", text: "Il numero di elettroni", correct: false },
              { label: "B", text: "Il numero di neutroni", correct: false },
              { label: "C", text: "Il numero di protoni", correct: true },
              { label: "D", text: "La somma di protoni ed elettroni", correct: false }
            ],
            explanation:
              "Il numero atomico identifica in modo univoco un elemento perché corrisponde al numero di protoni nel nucleo."
          },
          {
            question: "Un Miscuglio Omogeneo è caratterizzato da:",
            answers: [
              { label: "A", text: "Componenti visibilmente separati", correct: false },
              { label: "B", text: "Essere scomposto solo con metodi chimici", correct: false },
              { label: "C", text: "Essere formato da un solo tipo di atomi", correct: false },
              { label: "D", text: "Apparire come un'unica fase indistinguibile", correct: true }
            ],
            explanation:
              "Le soluzioni omogenee appaiono uniformi: i componenti non sono più distinguibili a occhio nudo."
          },
          {
            question: "La Filtrazione sfrutta la differenza di quale proprietà?",
            answers: [
              { label: "A", text: "Volatilità", correct: false },
              { label: "B", text: "Densità", correct: false },
              { label: "C", text: "Dimensione delle particelle", correct: true },
              { label: "D", text: "Carica elettrica", correct: false }
            ],
            explanation:
              "Un filtro trattiene le particelle più grandi e lascia passare quelle più piccole."
          },
          {
            question: "La Molecola è definita come:",
            answers: [
              { label: "A", text: "La più piccola parte di un elemento", correct: false },
              { label: "B", text: "L'insieme degli isotopi di un elemento", correct: false },
              { label: "C", text: "La più piccola parte di un composto che ne conserva le proprietà chimiche", correct: true },
              { label: "D", text: "La combinazione di un catione e un anione", correct: false }
            ],
            explanation:
              "La molecola mantiene le proprietà del composto di cui è costituita."
          },
          {
            question: "Quale metodo è paragonato a una decantazione accelerata dalla forza centrifuga?",
            answers: [
              { label: "A", text: "Decantazione", correct: false },
              { label: "B", text: "Distillazione", correct: false },
              { label: "C", text: "Centrifugazione", correct: true },
              { label: "D", text: "Filtrazione", correct: false }
            ],
            explanation:
              "La centrifugazione sfrutta la forza centrifuga per separare rapidamente componenti di diversa densità."
          },
          {
            question: "In un atomo neutro il numero di elettroni è uguale al numero di:",
            answers: [
              { label: "A", text: "Neutroni", correct: false },
              { label: "B", text: "Numero di massa (A)", correct: false },
              { label: "C", text: "Protoni", correct: true },
              { label: "D", text: "Isotopi", correct: false }
            ],
            explanation:
              "La neutralità richiede che le cariche negative degli elettroni bilancino le cariche positive dei protoni."
          },
          {
            question: "Quale caratteristica sfruttano distillazione semplice e frazionata?",
            answers: [
              { label: "A", text: "Dimensione delle particelle", correct: false },
              { label: "B", text: "Densità", correct: false },
              { label: "C", text: "Diversa volatilità o punti di ebollizione", correct: true },
              { label: "D", text: "Forza di gravità", correct: false }
            ],
            explanation:
              "Ogni sostanza pura possiede un punto di ebollizione caratteristico sfruttato dalla distillazione."
          },
          {
            question: "Gli elementi a sinistra della diagonale della Tavola Periodica sono per lo più:",
            answers: [
              { label: "A", text: "Non metalli", correct: false },
              { label: "B", text: "Semimetalli", correct: false },
              { label: "C", text: "Metalli", correct: true },
              { label: "D", text: "Gas nobili", correct: false }
            ],
            explanation:
              "I metalli sono lucenti, solidi (salvo eccezioni) e ottimi conduttori di calore ed elettricità."
          },
          {
            question: "Un atomo che diventa anione ha:",
            answers: [
              { label: "A", text: "Un protone in più", correct: false },
              { label: "B", text: "Un protone in meno", correct: false },
              { label: "C", text: "Elettroni in più", correct: true },
              { label: "D", text: "Elettroni in meno", correct: false }
            ],
            explanation:
              "L'acquisto di elettroni (cariche negative) rende l'atomo complessivamente negativo."
          },
          {
            question: "Cosa accade alle particelle quando si riscalda una sostanza?",
            answers: [
              { label: "A", text: "Si avvicinano", correct: false },
              { label: "B", text: "Nulla", correct: false },
              { label: "C", text: "Si allontanano (dilatazione)", correct: true },
              { label: "D", text: "Avviene solo condensazione", correct: false }
            ],
            explanation:
              "Il calore provoca dilatazione perché le particelle si allontanano aumentando l'energia cinetica."
          },
          {
            question: "Gli isotopi di un elemento differiscono per il numero di:",
            answers: [
              { label: "A", text: "Protoni", correct: false },
              { label: "B", text: "Neutroni", correct: true },
              { label: "C", text: "Elettroni", correct: false },
              { label: "D", text: "Molecole", correct: false }
            ],
            explanation:
              "Gli isotopi possiedono lo stesso numero di protoni ma differiscono nel numero di neutroni."
          },
          {
            question: "Qual è la definizione ufficiale di materia?",
            answers: [
              { label: "A", text: "Tutto ciò che è visibile", correct: false },
              { label: "B", text: "Tutto ciò che è composto da atomi", correct: false },
              { label: "C", text: "Tutto ciò che ha massa e occupa volume", correct: true },
              { label: "D", text: "Tutto ciò che reagisce chimicamente", correct: false }
            ],
            explanation:
              "La materia possiede massa e occupa spazio, distinguendosi dal concetto di vuoto."
          },
          {
            question: "Se una sostanza pura può essere scomposta con metodi chimici, è:",
            answers: [
              { label: "A", text: "Un miscuglio", correct: false },
              { label: "B", text: "Un elemento", correct: false },
              { label: "C", text: "Un composto chimico", correct: true },
              { label: "D", text: "Una soluzione", correct: false }
            ],
            explanation:
              "I composti chimici possono essere decomposti in elementi tramite reazioni chimiche."
          },
          {
            question: "Il Numero di Massa (A) corrisponde alla somma di:",
            answers: [
              { label: "A", text: "Elettroni e neutroni", correct: false },
              { label: "B", text: "Elettroni e protoni", correct: false },
              { label: "C", text: "Protoni ed elettroni", correct: false },
              { label: "D", text: "Protoni e neutroni", correct: true }
            ],
            explanation:
              "La massa dell'atomo è concentrata nel nucleo, formato da protoni e neutroni."
          },
          {
            question: "A quale livello la chimica studia la materia?",
            answers: [
              { label: "A", text: "Macroscopico", correct: false },
              { label: "B", text: "Microscopico o ultramicroscopico", correct: true },
              { label: "C", text: "Livello elementare", correct: false },
              { label: "D", text: "Livello ionico", correct: false }
            ],
            explanation:
              "La chimica indaga cosa accade all'interno della materia osservando atomi e molecole."
          },
          {
            question: "La decantazione si basa su quale combinazione?",
            answers: [
              { label: "A", text: "Volatilità e calore", correct: false },
              { label: "B", text: "Dimensione delle particelle e filtro", correct: false },
              { label: "C", text: "Diversa densità e forza di gravità", correct: true },
              { label: "D", text: "Forza centrifuga e dimensione", correct: false }
            ],
            explanation:
              "Le particelle più dense precipitano sul fondo grazie all'azione della gravità."
          },
          {
            question: "Un catione si forma quando l'atomo neutro:",
            answers: [
              { label: "A", text: "Acquista protoni", correct: false },
              { label: "B", text: "Perde elettroni", correct: true },
              { label: "C", text: "Perde neutroni", correct: false },
              { label: "D", text: "Acquista cariche neutre", correct: false }
            ],
            explanation:
              "Per diventare positivo l'atomo deve perdere elettroni, le uniche particelle che possono variare."
          },
          {
            question: "Qual è una caratteristica dei non metalli solidi?",
            answers: [
              { label: "A", text: "Sono lucenti", correct: false },
              { label: "B", text: "Ottimi conduttori", correct: false },
              { label: "C", text: "Duttili e malleabili", correct: false },
              { label: "D", text: "Opachi e fragili", correct: true }
            ],
            explanation:
              "I non metalli sono l'opposto dei metalli: opachi, poco conduttori e spesso fragili."
          },
          {
            question: "Nello stato aeriforme le particelle:",
            answers: [
              { label: "A", text: "Sono vicine con legami forti", correct: false },
              { label: "B", text: "Sono più lontane ma legate", correct: false },
              { label: "C", text: "Sono molto distanti e non formano legami", correct: true },
              { label: "D", text: "Si restringono se riscaldate", correct: false }
            ],
            explanation:
              "I gas tendono a occupare tutto il volume disponibile perché le particelle sono molto distanti."
          }
        ],
        easy: [
          {
            question: "Che cos'è la Materia?",
            answers: [
              { label: "A", text: "Tutto ciò che è visibile", correct: false },
              { label: "B", text: "Tutto ciò che è caldo", correct: false },
              { label: "C", text: "Tutto ciò che ha massa e occupa spazio", correct: true },
              { label: "D", text: "Tutto ciò che si rompe", correct: false }
            ],
            explanation:
              "La materia è tutto ciò che possiede massa e occupa un volume determinato."
          },
          {
            question: "Nella decantazione di fango e acqua, quale forza fa scendere il fango?",
            answers: [
              { label: "A", text: "Forza centrifuga", correct: false },
              { label: "B", text: "Forza di gravità", correct: true },
              { label: "C", text: "Forza magnetica", correct: false },
              { label: "D", text: "Forza di pressione", correct: false }
            ],
            explanation:
              "La decantazione sfrutta la diversa densità delle particelle unite all'azione della gravità."
          },
          {
            question: "Perché un bicchiere che sembra vuoto è in realtà pieno?",
            answers: [
              { label: "A", text: "È pieno di elettricità", correct: false },
              { label: "B", text: "È pieno di aria", correct: true },
              { label: "C", text: "È pieno di atomi visibili", correct: false },
              { label: "D", text: "È pieno di luce", correct: false }
            ],
            explanation:
              "L'aria è materia, ha massa e occupa spazio, perciò riempie gli ambienti che crediamo vuoti."
          },
          {
            question: "Ferro, oro e rame sono lucenti e ottimi conduttori. Come si chiamano?",
            answers: [
              { label: "A", text: "Non metalli", correct: false },
              { label: "B", text: "Gas nobili", correct: false },
              { label: "C", text: "Metalli", correct: true },
              { label: "D", text: "Semimetalli", correct: false }
            ],
            explanation:
              "I metalli occupano la parte sinistra della tavola periodica e condividono queste proprietà."
          },
          {
            question: "A quale livello studia la materia la chimica?",
            answers: [
              { label: "A", text: "Livello atomico/microscopico", correct: true },
              { label: "B", text: "Livello macroscopico", correct: false },
              { label: "C", text: "Livello visibile", correct: false },
              { label: "D", text: "Livello sonoro", correct: false }
            ],
            explanation:
              "La chimica osserva la struttura interna della materia analizzando atomi e molecole."
          },
          {
            question: "Un miscuglio eterogeneo è un miscuglio in cui...",
            answers: [
              { label: "A", text: "I componenti non si vedono", correct: false },
              { label: "B", text: "I componenti sono distinguibili", correct: true },
              { label: "C", text: "È una sostanza pura", correct: false },
              { label: "D", text: "Si separa solo per distillazione", correct: false }
            ],
            explanation:
              "Nei miscugli eterogenei (es. acqua e olio) i componenti restano separati e visibili."
          },
          {
            question: "Usare lo scolapasta per scolare la pasta è un esempio di:",
            answers: [
              { label: "A", text: "Separazione per colore", correct: false },
              { label: "B", text: "Separazione per densità", correct: false },
              { label: "C", text: "Filtrazione basata sulla dimensione", correct: true },
              { label: "D", text: "Distillazione", correct: false }
            ],
            explanation:
              "Lo scolapasta trattiene la pasta perché è più grande dei fori: un chiaro esempio di filtrazione."
          },
          {
            question: "Cosa accade alle particelle quando raffreddi un oggetto?",
            answers: [
              { label: "A", text: "Nulla", correct: false },
              { label: "B", text: "Restano ferme", correct: false },
              { label: "C", text: "Si avvicinano e l'oggetto si restringe", correct: true },
              { label: "D", text: "L'oggetto diventa più pesante", correct: false }
            ],
            explanation:
              "Il raffreddamento provoca restringimento perché le particelle diminuiscono la distanza reciproca."
          },
          {
            question: "Quali particelle identificano in modo univoco un elemento?",
            answers: [
              { label: "A", text: "Elettroni", correct: false },
              { label: "B", text: "Neutroni", correct: false },
              { label: "C", text: "Protoni", correct: true },
              { label: "D", text: "Ioni", correct: false }
            ],
            explanation:
              "Il numero di protoni (Z) non varia per un elemento: è la sua carta d'identità."
          },
          {
            question: "Un miscuglio omogeneo come acqua e sale appare:",
            answers: [
              { label: "A", text: "Con due strati separati", correct: false },
              { label: "B", text: "Come un'unica fase", correct: true },
              { label: "C", text: "Come un solido", correct: false },
              { label: "D", text: "Come un elemento chimico", correct: false }
            ],
            explanation:
              "In una soluzione i componenti sono completamente miscelati e non si distinguono."
          },
          {
            question: "Dove si trovano gli elettroni in un atomo?",
            answers: [
              { label: "A", text: "Non esistono", correct: false },
              { label: "B", text: "Dentro il nucleo", correct: false },
              { label: "C", text: "Ruotano intorno al nucleo", correct: true },
              { label: "D", text: "Si toccano con altri elettroni", correct: false }
            ],
            explanation:
              "Gli elettroni si muovono attorno al nucleo in orbitali, formando la nuvola elettronica."
          },
          {
            question: "Qual è l'elemento 're della vita' nell'acronimo CHOMPS?",
            answers: [
              { label: "A", text: "Carbonio", correct: true },
              { label: "B", text: "Cloro", correct: false },
              { label: "C", text: "Calcio", correct: false },
              { label: "D", text: "Rame", correct: false }
            ],
            explanation:
              "La vita si è organizzata intorno all'atomo di carbonio, capace di formare numerosi legami."
          },
          {
            question: "Una sostanza pura formata da due o più elementi è chiamata:",
            answers: [
              { label: "A", text: "Miscuglio", correct: false },
              { label: "B", text: "Elemento", correct: false },
              { label: "C", text: "Composto chimico", correct: true },
              { label: "D", text: "Soluzione", correct: false }
            ],
            explanation:
              "I composti chimici possono essere decomposti solo tramite reazioni chimiche."
          },
          {
            question: "Quale metodo usa la forza centrifuga per accelerare la decantazione?",
            answers: [
              { label: "A", text: "Filtrazione", correct: false },
              { label: "B", text: "Centrifugazione", correct: true },
              { label: "C", text: "Distillazione", correct: false },
              { label: "D", text: "Decantazione", correct: false }
            ],
            explanation:
              "La centrifuga separa rapidamente particelle di diversa densità sfruttando una rotazione ad alta velocità."
          },
          {
            question: "Quanti tipi di atomi contiene un blocco di ferro (Fe)?",
            answers: [
              { label: "A", text: "Diversi tipi", correct: false },
              { label: "B", text: "Nessun atomo", correct: false },
              { label: "C", text: "Solo atomi uguali di ferro", correct: true },
              { label: "D", text: "Solo molecole", correct: false }
            ],
            explanation:
              "Un elemento è formato esclusivamente da atomi con lo stesso numero atomico."
          },
          {
            question: "Se un atomo neutro perde elettroni, che carica assume?",
            answers: [
              { label: "A", text: "Neutra", correct: false },
              { label: "B", text: "Positiva (catione)", correct: true },
              { label: "C", text: "Negativa", correct: false },
              { label: "D", text: "Impossibile", correct: false }
            ],
            explanation:
              "Perdendo cariche negative, l'atomo resta con un eccesso di carica positiva."
          },
          {
            question: "Che tipo di elemento è l'idrogeno?",
            answers: [
              { label: "A", text: "Gas nobile", correct: false },
              { label: "B", text: "Non metallo", correct: true },
              { label: "C", text: "Semimetallo", correct: false },
              { label: "D", text: "Metallo liquido", correct: false }
            ],
            explanation:
              "L'idrogeno è un non metallo gassoso ed è un'eccezione nella zona dei metalli."
          },
          {
            question: "La distillazione separa sostanze in base a quale proprietà?",
            answers: [
              { label: "A", text: "Stratificazione", correct: false },
              { label: "B", text: "Dimensione", correct: false },
              { label: "C", text: "Volatilità/punto di ebollizione", correct: true },
              { label: "D", text: "Forza di gravità", correct: false }
            ],
            explanation:
              "Ogni sostanza ha un proprio punto di ebollizione sfruttato dalla distillazione."
          },
          {
            question: "La struttura dell'atomo è per la maggior parte:",
            answers: [
              { label: "A", text: "Piena di molecole", correct: false },
              { label: "B", text: "Piena d'acqua", correct: false },
              { label: "C", text: "Spazio vuoto", correct: true },
              { label: "D", text: "Piena di legami", correct: false }
            ],
            explanation:
              "L'atomo è quasi completamente vuoto: la massa è concentrata nel nucleo."
          },
          {
            question: "In quale forma si trovano calcio e sodio disciolti in acqua?",
            answers: [
              { label: "A", text: "Solida", correct: false },
              { label: "B", text: "Ionica", correct: true },
              { label: "C", text: "Neutra", correct: false },
              { label: "D", text: "Gassosa", correct: false }
            ],
            explanation:
              "In soluzione acquosa i sali sono presenti come ioni positivi e negativi."
          }
        ],
        medium: [
          {
            question: "Se una materia non è separabile fisicamente ma lo è chimicamente, è:",
            answers: [
              { label: "A", text: "Elemento", correct: false },
              { label: "B", text: "Miscuglio eterogeneo", correct: false },
              { label: "C", text: "Composto chimico", correct: true },
              { label: "D", text: "Miscuglio omogeneo", correct: false }
            ],
            explanation:
              "Prima si verifica se è un miscuglio; se non lo è, è sostanza pura. Se è scindibile chimicamente si tratta di un composto."
          },
          {
            question: "Il numero atomico Z fornisce:",
            answers: [
              { label: "A", text: "Il numero di massa A", correct: false },
              { label: "B", text: "Il numero di protoni", correct: true },
              { label: "C", text: "Il numero totale di elettroni", correct: false },
              { label: "D", text: "Il numero di neutroni", correct: false }
            ],
            explanation:
              "Z è la carta d'identità dell'elemento e rappresenta il numero di protoni nel nucleo."
          },
          {
            question: "Perché filtrare acqua salata non separa il sale?",
            answers: [
              { label: "A", text: "Il sale è troppo pesante", correct: false },
              { label: "B", text: "Serve la decantazione", correct: false },
              { label: "C", text: "Il sale è più volatile", correct: false },
              { label: "D", text: "Le particelle in soluzione sono troppo piccole per i pori", correct: true }
            ],
            explanation:
              "Nelle soluzioni le particelle sono disperse a livello molecolare e attraversano il filtro senza essere trattenute."
          },
          {
            question: "Quale principio rende possibile la distillazione di una soluzione?",
            answers: [
              { label: "A", text: "Il miscuglio è reversibile", correct: false },
              { label: "B", text: "La materia è fatta di atomi", correct: false },
              { label: "C", text: "Ogni sostanza pura ha un punto di ebollizione specifico", correct: true },
              { label: "D", text: "I legami chimici sono fortissimi", correct: false }
            ],
            explanation:
              "Scaldando si raggiungono i diversi punti di ebollizione dei componenti e li si separa fisicamente."
          },
          {
            question: "Un atomo con Z=17 e A=35 che è anione -1 possiede quanti elettroni?",
            answers: [
              { label: "A", text: "17", correct: false },
              { label: "B", text: "18", correct: true },
              { label: "C", text: "35", correct: false },
              { label: "D", text: "18", correct: true }
            ],
            explanation:
              "Lo stato neutro avrebbe 17 elettroni; l'anione -1 ne possiede uno in più, quindi 18 elettroni."
          },
          {
            question: "Qual è il paradosso della materia rispetto alla struttura atomica?",
            answers: [
              { label: "A", text: "L'atomo è più grande della molecola", correct: false },
              { label: "B", text: "La materia è piena ma l'atomo è quasi vuoto", correct: true },
              { label: "C", text: "I non metalli conducono calore", correct: false },
              { label: "D", text: "I protoni variano, gli elettroni no", correct: false }
            ],
            explanation:
              "Percepiamo gli oggetti solidi come pieni, ma i loro atomi sono composti prevalentemente da spazio vuoto."
          },
          {
            question: "Perché la centrifugazione è una decantazione accelerata?",
            answers: [
              { label: "A", text: "Sfrutta calore e volatilità", correct: false },
              { label: "B", text: "Usa la forza centrifuga per separare in base alla densità", correct: true },
              { label: "C", text: "Moltiplica la gravità per la dimensione", correct: false },
              { label: "D", text: "Implica filtri a maglia stretta", correct: false }
            ],
            explanation:
              "La forza centrifuga è molto più intensa della gravità e velocizza la stratificazione delle particelle."
          },
          {
            question: "Due isotopi dello stesso elemento hanno:",
            answers: [
              { label: "A", text: "Diverso Z e proprietà chimiche", correct: false },
              { label: "B", text: "Stesso A e neutroni", correct: false },
              { label: "C", text: "Stesso Z e proprietà chimiche ma diverso A", correct: true },
              { label: "D", text: "Diversi protoni ed elettroni", correct: false }
            ],
            explanation:
              "Gli isotopi condividono numero di protoni (Z) e quindi chimica identica, ma differiscono nel numero di neutroni."
          },
          {
            question: "Qual è la differenza tra acqua distillata e acqua potabile?",
            answers: [
              { label: "A", text: "L'acqua distillata è un elemento", correct: false },
              { label: "B", text: "L'acqua potabile è un composto", correct: false },
              { label: "C", text: "La distillata contiene solo H2O, la potabile sali e gas disciolti", correct: true },
              { label: "D", text: "La potabile è fatta solo di idrogeno", correct: false }
            ],
            explanation:
              "L'acqua potabile è una soluzione ionica con sali e gas; l'acqua distillata è una sostanza pura."
          },
          {
            question: "I metalli tendono a perdere elettroni. Com'è un catione di sodio (Na+)?",
            answers: [
              { label: "A", text: "11 protoni e 12 elettroni", correct: false },
              { label: "B", text: "12 protoni e 11 elettroni", correct: false },
              { label: "C", text: "11 protoni e 10 elettroni", correct: true },
              { label: "D", text: "10 protoni e 11 elettroni", correct: false }
            ],
            explanation:
              "Il sodio ha 11 protoni. Per avere carica +1 perde un elettrone e ne possiede 10."
          },
          {
            question: "Perché gli atomi di un solido non si toccano pur essendo compatti?",
            answers: [
              { label: "A", text: "Il solido è vuoto", correct: false },
              { label: "B", text: "Le particelle sono troppo lontane", correct: false },
              { label: "C", text: "Gli elettroni si respingono ma i legami li tengono vicini", correct: true },
              { label: "D", text: "I neutroni si annullano", correct: false }
            ],
            explanation:
              "Gli elettroni con carica negativa impediscono il contatto, mentre i legami chimici garantiscono la coesione."
          },
          {
            question: "Raffreddare e comprimere un gas tende a trasformarlo in quale stato?",
            answers: [
              { label: "A", text: "Solido per dilatazione", correct: false },
              { label: "B", text: "Liquido grazie al restringimento delle particelle", correct: true },
              { label: "C", text: "Aeriforme sfruttando l'espansione", correct: false },
              { label: "D", text: "Ionico per carica", correct: false }
            ],
            explanation:
              "Per liquefare un gas è necessario avvicinare le particelle, usando bassa temperatura e pressione elevata."
          },
          {
            question: "Quando si usa la distillazione frazionata invece della semplice?",
            answers: [
              { label: "A", text: "Per miscugli eterogenei", correct: false },
              { label: "B", text: "Solo per l'acqua", correct: false },
              { label: "C", text: "Quando i punti di ebollizione sono molto vicini", correct: true },
              { label: "D", text: "Per separare solidi da gas", correct: false }
            ],
            explanation:
              "Se le temperature di ebollizione differiscono di meno di 25 °C si impiega una colonna frazionata."
          },
          {
            question: "Se varia il numero di neutroni in un atomo neutro, cosa cambia?",
            answers: [
              { label: "A", text: "Varia Z", correct: false },
              { label: "B", text: "Varia A ma restano invariati Z e proprietà chimiche", correct: true },
              { label: "C", text: "Varia la carica", correct: false },
              { label: "D", text: "Cambia il simbolo chimico", correct: false }
            ],
            explanation:
              "La variazione di neutroni genera isotopi: stesso elemento, differente numero di massa (A)."
          },
          {
            question: "Quale proprietà sfruttano in comune decantazione e centrifugazione?",
            answers: [
              { label: "A", text: "Volatilità", correct: false },
              { label: "B", text: "Densità", correct: true },
              { label: "C", text: "Dimensione dei pori", correct: false },
              { label: "D", text: "Carica elettrica", correct: false }
            ],
            explanation:
              "Entrambi i metodi separano in base alla diversa densità; cambiano solo le forze coinvolte."
          },
          {
            question: "Perché un elemento è formato da atomi tutti uguali?",
            answers: [
              { label: "A", text: "Hanno gli stessi neutroni", correct: false },
              { label: "B", text: "Formano un composto", correct: false },
              { label: "C", text: "Condividono lo stesso numero atomico Z", correct: true },
              { label: "D", text: "Hanno le stesse proprietà fisiche", correct: false }
            ],
            explanation:
              "Il numero di protoni è identico per tutti gli atomi di un elemento, quindi appartengono alla stessa specie."
          },
          {
            question: "Qual è la sola particella che può essere ceduta o acquistata senza cambiare l'identità chimica?",
            answers: [
              { label: "A", text: "Protone", correct: false },
              { label: "B", text: "Elettrone", correct: true },
              { label: "C", text: "Neutrone", correct: false },
              { label: "D", text: "Fotone", correct: false }
            ],
            explanation:
              "Variando il numero di elettroni si formano ioni ma il numero atomico rimane invariato."
          },
          {
            question: "CHOMPS indica i sei elementi fondamentali della vita. Quale elemento è centrale?",
            answers: [
              { label: "A", text: "Ossigeno", correct: false },
              { label: "B", text: "Idrogeno", correct: false },
              { label: "C", text: "Fosforo", correct: false },
              { label: "D", text: "Carbonio", correct: true }
            ],
            explanation:
              "Il carbonio può formare lunghe catene e strutture complesse, rendendolo la base della chimica organica."
          },
          {
            question: "Cosa succede agli ioni di un sale quando viene sciolto in acqua?",
            answers: [
              { label: "A", text: "Scompaiono", correct: false },
              { label: "B", text: "Formano molecole neutre", correct: false },
              { label: "C", text: "Restano in forma ionica separata", correct: true },
              { label: "D", text: "Diventano isotopi", correct: false }
            ],
            explanation:
              "In soluzione gli ioni rimangono carichi e circondati dalle molecole d'acqua."
          },
          {
            question: "Quale caratteristica distingue nettamente metalli e non metalli?",
            answers: [
              { label: "A", text: "I metalli sono gassosi", correct: false },
              { label: "B", text: "Entrambi sono fragili", correct: false },
              { label: "C", text: "I metalli sono duttili e conduttori; i non metalli opachi e fragili", correct: true },
              { label: "D", text: "I non metalli sono lucenti", correct: false }
            ],
            explanation:
              "I metalli conducono bene e sono malleabili, mentre i non metalli sono cattivi conduttori e spesso fragili."
          }
        ],
        hard: [
          {
            question: "Se una sostanza non è separabile per evaporazione ma lo è per elettrolisi, è:",
            answers: [
              { label: "A", text: "Miscuglio omogeneo", correct: false },
              { label: "B", text: "Elemento", correct: false },
              { label: "C", text: "Composto chimico", correct: true },
              { label: "D", text: "Sostanza pura indifferenziata", correct: false }
            ],
            explanation:
              "Non essendo separabile fisicamente ma decomponibile chimicamente, la sostanza è classificata come composto."
          },
          {
            question: "Un atomo neutro con Z=15 e A=31 possiede:",
            answers: [
              { label: "A", text: "15 elettroni e 31 protoni", correct: false },
              { label: "B", text: "16 protoni e 15 elettroni", correct: false },
              { label: "C", text: "Massa concentrata negli elettroni", correct: false },
              { label: "D", text: "15 protoni e 16 neutroni", correct: true }
            ],
            explanation:
              "Il numero di neutroni è dato da A - Z = 31 - 15 = 16, mentre la massa è concentrata nel nucleo."
          },
          {
            question: "Perché la decantazione semplice è poco efficiente per particelle molto piccole?",
            answers: [
              { label: "A", text: "Richiede temperature elevate", correct: false },
              { label: "B", text: "Si affida alla lenta forza di gravità", correct: true },
              { label: "C", text: "Non sfrutta la densità", correct: false },
              { label: "D", text: "È adatta solo per soluzioni", correct: false }
            ],
            explanation:
              "Particelle minute impiegano tempi lunghi a depositarsi per gravità, motivo per cui si preferisce la centrifugazione."
          },
          {
            question: "Il principio della repulsione degli elettroni e dei legami forti spiega:",
            answers: [
              { label: "A", text: "Come separare acqua e sale", correct: false },
              { label: "B", text: "La differenza tra isotopi", correct: false },
              { label: "C", text: "Perché la mano non attraversa il tavolo pur senza contatto atomico", correct: true },
              { label: "D", text: "Come si forma uno ione", correct: false }
            ],
            explanation:
              "Gli elettroni si respingono impedendo il contatto diretto, mentre i legami chimici mantengono la struttura solida."
          },
          {
            question: "Quando un composto ionico si scioglie in acqua, in che forma restano i suoi componenti?",
            answers: [
              { label: "A", text: "Atomi neutri", correct: false },
              { label: "B", text: "Molecole del composto intatte", correct: false },
              { label: "C", text: "Ioni carichi", correct: true },
              { label: "D", text: "Protoni e neutroni liberi", correct: false }
            ],
            explanation:
              "I sali in acqua restano sotto forma di cationi e anioni circondati da molecole d'acqua."
          },
          {
            question: "Per la specie 20/40 Ca^{+2}, quanti protoni, neutroni ed elettroni?",
            answers: [
              { label: "A", text: "20 protoni, 20 neutroni, 22 elettroni", correct: false },
              { label: "B", text: "20 protoni, 20 neutroni, 18 elettroni", correct: true },
              { label: "C", text: "22 protoni, 18 neutroni, 20 elettroni", correct: false },
              { label: "D", text: "20 protoni, 40 neutroni, 20 elettroni", correct: false }
            ],
            explanation:
              "Z=20 indica 20 protoni; A=40 implica 20 neutroni; la carica +2 significa due elettroni in meno (18)."
          },
          {
            question: "Perché conoscere la dimensione delle particelle è fondamentale prima di una filtrazione?",
            answers: [
              { label: "A", text: "Per determinare la volatilità", correct: false },
              { label: "B", text: "Per calcolare la densità", correct: false },
              { label: "C", text: "Per scegliere pori abbastanza piccoli da trattenere le particelle", correct: true },
              { label: "D", text: "La dimensione è irrilevante", correct: false }
            ],
            explanation:
              "Se i pori del filtro sono più grandi delle particelle, queste passeranno e la separazione fallirà."
          },
          {
            question: "Il Carbonio-14 ha le stesse proprietà chimiche del Carbonio-12 perché:",
            answers: [
              { label: "A", text: "Ha numero atomico 8", correct: false },
              { label: "B", text: "I neutroni determinano le proprietà chimiche", correct: false },
              { label: "C", text: "Il numero atomico e gli elettroni restano invariati", correct: true },
              { label: "D", text: "È un composto", correct: false }
            ],
            explanation:
              "Gli isotopi condividono protoni ed elettroni, quindi reagiscono allo stesso modo nonostante masse diverse."
          },
          {
            question: "Perché l'idrogeno, pur trovandosi a sinistra della tavola, non è un metallo?",
            answers: [
              { label: "A", text: "È un metallo liquido", correct: false },
              { label: "B", text: "È un semimetallo", correct: false },
              { label: "C", text: "È un non metallo gassoso che richiede pressione e freddo per liquefarsi", correct: true },
              { label: "D", text: "Il suo protone lo rende il re della vita", correct: false }
            ],
            explanation:
              "L'idrogeno è un non metallo gassoso ed è un'eccezione rispetto agli elementi metallici della stessa zona."
          },
          {
            question: "Qual è la relazione corretta tra elemento e composto chimico?",
            answers: [
              { label: "A", text: "Il composto è la parte più piccola dell'elemento", correct: false },
              { label: "B", text: "Entrambi sono miscugli", correct: false },
              { label: "C", text: "Un elemento è indivisibile chimicamente; un composto unisce più elementi", correct: true },
              { label: "D", text: "Entrambi si separano con metodi fisici", correct: false }
            ],
            explanation:
              "Gli elementi sono sostanze pure semplici, mentre i composti sono combinazioni di elementi separabili solo chimicamente."
          },
          {
            question: "Quando è necessaria la distillazione frazionata rispetto a quella semplice?",
            answers: [
              { label: "A", text: "Per separare miscugli eterogenei", correct: false },
              { label: "B", text: "Quando serve forza centrifuga", correct: false },
              { label: "C", text: "Quando i punti di ebollizione sono molto vicini (meno di 25 °C)", correct: true },
              { label: "D", text: "Quando i componenti non sono volatili", correct: false }
            ],
            explanation:
              "La colonna frazionata consente una separazione accurata quando le temperature di ebollizione differiscono di poco."
          },
          {
            question: "Come si concilia lo studio microscopico della chimica con le proprietà macroscopiche degli elementi?",
            answers: [
              { label: "A", text: "Il singolo atomo ha le stesse proprietà macroscopiche", correct: false },
              { label: "B", text: "La tavola descrive solo il livello microscopico", correct: false },
              { label: "C", text: "Le proprietà macroscopiche emergono dall'insieme di molti atomi, ma la tavola riporta anche quelle chimiche", correct: true },
              { label: "D", text: "Le proprietà chimiche e fisiche coincidono sempre", correct: false }
            ],
            explanation:
              "La tavola periodica collega il comportamento del singolo atomo con le proprietà macroscopiche quando molti atomi si combinano."
          },
          {
            question: "Se un atomo neutro di Carbonio (Z=6) acquisisce quattro elettroni diventando C⁴⁻, quale affermazione è falsa?",
            answers: [
              { label: "A", text: "È diventato un anione", correct: false },
              { label: "B", text: "Il numero atomico resta 6", correct: false },
              { label: "C", text: "Ora possiede 10 elettroni", correct: false },
              { label: "D", text: "È cambiato il numero di massa A", correct: true }
            ],
            explanation:
              "L'acquisto di elettroni modifica la carica ma non il numero di massa, che dipende da protoni e neutroni."
          },
          {
            question: "Quando è necessario impiegare la centrifugazione invece della semplice decantazione?",
            answers: [
              { label: "A", text: "Quando il miscuglio è omogeneo", correct: false },
              { label: "B", text: "Quando i componenti hanno la stessa densità", correct: false },
              { label: "C", text: "Quando la separazione per sola gravità è troppo lenta", correct: true },
              { label: "D", text: "Quando i componenti hanno diversi punti di ebollizione", correct: false }
            ],
            explanation:
              "La centrifuga fornisce una forza molto maggiore della gravità, utile quando la decantazione sarebbe inefficiente."
          },
          {
            question: "Qual è il criterio che classifica l'acqua distillata come sostanza pura e l'acqua potabile come miscuglio?",
            answers: [
              { label: "A", text: "La possibilità di scomporre l'acqua distillata in H e O", correct: false },
              { label: "B", text: "L'acqua potabile è un composto", correct: false },
              { label: "C", text: "Nell'acqua potabile i sali e i gas disciolti si separano con metodi fisici", correct: true },
              { label: "D", text: "L'evaporazione è irreversibile solo per l'acqua potabile", correct: false }
            ],
            explanation:
              "La domanda chiave è se il sistema è separabile fisicamente: l'acqua potabile sì (è una soluzione), l'acqua distillata no (sostanza pura)."
          },
          {
            question: "Perché la definizione di molecola è centrale per la chimica?",
            answers: [
              { label: "A", text: "Un composto può essere fatto da un solo atomo", correct: false },
              { label: "B", text: "Le proprietà chimiche di un composto dipendono dall'insieme specifico di atomi", correct: true },
              { label: "C", text: "Tutte le molecole hanno formule identiche", correct: false },
              { label: "D", text: "La molecola ha lo stesso numero di protoni dell'atomo", correct: false }
            ],
            explanation:
              "La molecola rappresenta il livello in cui emergono le proprietà di un composto, diverse da quelle del singolo elemento."
          },
          {
            question: "Quale fenomeno non richiede il principio di dilatazione o restringimento delle particelle?",
            answers: [
              { label: "A", text: "Evaporazione di un liquido", correct: false },
              { label: "B", text: "Liquefazione di un gas", correct: false },
              { label: "C", text: "Separazione di olio e acqua in due strati", correct: true },
              { label: "D", text: "Raffreddamento di un oggetto", correct: false }
            ],
            explanation:
              "La separazione di olio e acqua è dovuta alla diversa densità e non a variazioni di volume con la temperatura."
          },
          {
            question: "Come si distribuisce la massa totale di un atomo rispetto alla sua struttura interna?",
            answers: [
              { label: "A", text: "Uniformemente tra elettroni e nucleo", correct: false },
              { label: "B", text: "L'atomo è pieno e compatto", correct: false },
              { label: "C", text: "La massa è quasi tutta nel nucleo nonostante l'atomo sia quasi vuoto", correct: true },
              { label: "D", text: "Dipende solo dal numero atomico", correct: false }
            ],
            explanation:
              "Protoni e neutroni nel nucleo concentrano quasi tutta la massa, mentre gli elettroni occupano regioni quasi vuote."
          },
          {
            question: "Qual è l'unica particella subatomica che, variando, cambia il numero di massa senza alterare l'identità chimica?",
            answers: [
              { label: "A", text: "Protone", correct: false },
              { label: "B", text: "Elettrone", correct: false },
              { label: "C", text: "Neutrone", correct: true },
              { label: "D", text: "Ione", correct: false }
            ],
            explanation:
              "Variando il numero di neutroni si ottengono isotopi dello stesso elemento: A cambia, Z resta invariato."
          },
          {
            question: "Perché i sei elementi CHOMPS sono così importanti per la vita?",
            answers: [
              { label: "A", text: "Tutti gli elementi della tavola sono necessari", correct: false },
              { label: "B", text: "CHOMPS sono miscugli omogenei", correct: false },
              { label: "C", text: "Pochi elementi, guidati dal carbonio, formano l'enorme varietà di molecole viventi", correct: true },
              { label: "D", text: "Solo gli elementi CHOMPS possono formare ioni", correct: false }
            ],
            explanation:
              "La vita sfrutta principalmente carbonio, idrogeno, ossigeno, azoto, fosforo e zolfo per costruire molecole complesse."
          },
        ]
      };

      const difficultyButtons = document.querySelectorAll('.difficulty-buttons button');
      const quizCard = document.getElementById('quizCard');
      const scorePanel = document.getElementById('scorePanel');
      const questionText = document.getElementById('questionText');
      const optionsList = document.getElementById('options');
      const feedbackBox = document.getElementById('feedback');
      const nextButton = document.getElementById('nextButton');
      const resetButton = document.getElementById('resetButton');
      const restartButton = document.getElementById('restartButton');
      const chooseButton = document.getElementById('chooseButton');
      const questionCounter = document.getElementById('questionCounter');
      const scoreCounter = document.getElementById('scoreCounter');
      const finalScore = document.getElementById('finalScore');
      const finalAccuracy = document.getElementById('finalAccuracy');
      const finalSummary = document.getElementById('finalSummary');

      const state = {
        level: null,
        questions: [],
        currentIndex: 0,
        score: 0
      };

      const shuffle = (array) => {
        const items = [...array];
        for (let i = items.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [items[i], items[j]] = [items[j], items[i]];
        }
        return items;
      };

      function resetUI() {
        quizCard.classList.add('hidden');
        scorePanel.classList.add('hidden');
        feedbackBox.classList.remove('visible', 'positive', 'negative');
        feedbackBox.textContent = '';
        optionsList.innerHTML = '';
        nextButton.disabled = true;
      }

      function startQuiz(level) {
        state.level = level;
        state.questions = shuffle(questionBank[level]);
        state.currentIndex = 0;
        state.score = 0;
        difficultyButtons.forEach((btn) => btn.classList.toggle('active', btn.dataset.level === level));
        scorePanel.classList.add('hidden');
        quizCard.classList.remove('hidden');
        renderQuestion();
      }

      function renderQuestion() {
        const question = state.questions[state.currentIndex];
        questionText.textContent = question.question;
        questionCounter.textContent = `Domanda ${state.currentIndex + 1} di ${state.questions.length}`;
        scoreCounter.textContent = `Punteggio: ${state.score}`;
        feedbackBox.className = 'feedback';
        feedbackBox.textContent = '';
        nextButton.disabled = true;
        optionsList.innerHTML = '';

        const answers = shuffle(question.answers);
        answers.forEach((answer) => {
          const button = document.createElement('button');
          button.className = 'option';
          button.innerHTML = `<span>${answer.label}.</span>${answer.text}`;
          button.type = 'button';
          button.dataset.label = answer.label;
          button.addEventListener('click', () => handleAnswer(button, answer.correct, question));
          optionsList.appendChild(button);
        });
      }

      function handleAnswer(selectedButton, isCorrect, question) {
        const optionButtons = optionsList.querySelectorAll('.option');
        optionButtons.forEach((btn) => {
          btn.disabled = true;
          const answerLabel = btn.dataset.label;
          const answerData = question.answers.find((a) => a.label === answerLabel);
          if (answerData?.correct) {
            btn.classList.add('correct');
          }
        });

        if (isCorrect) {
          state.score += 1;
          selectedButton.classList.add('correct');
          feedbackBox.textContent = `Corretto! ${question.explanation}`;
          feedbackBox.classList.add('visible', 'positive');
        } else {
          selectedButton.classList.add('wrong');
          feedbackBox.textContent = `Risposta errata. ${question.explanation}`;
          feedbackBox.classList.add('visible', 'negative');
        }

        nextButton.disabled = false;
        nextButton.textContent = state.currentIndex < state.questions.length - 1 ? 'Domanda successiva' : 'Mostra risultati';
        scoreCounter.textContent = `Punteggio: ${state.score}`;
      }

      function showResults() {
        quizCard.classList.add('hidden');
        scorePanel.classList.remove('hidden');
        const total = state.questions.length;
        const percent = Math.round((state.score / total) * 100);
        finalScore.textContent = `Hai risposto correttamente a ${state.score} su ${total} domande.`;
        finalAccuracy.textContent = `Accuratezza: ${percent}%`;
        finalSummary.textContent = percent >= 80
          ? 'Ottimo lavoro! Continua così.'
          : percent >= 60
          ? 'Buon risultato, ma puoi ancora migliorare rivedendo le spiegazioni.'
          : 'Ti consigliamo di ripassare le spiegazioni e riprovare per consolidare le basi.';
      }

      nextButton.addEventListener('click', () => {
        if (state.currentIndex < state.questions.length - 1) {
          state.currentIndex += 1;
          renderQuestion();
        } else {
          showResults();
        }
      });

      resetButton.addEventListener('click', () => {
        resetUI();
        difficultyButtons.forEach((btn) => btn.classList.remove('active'));
      });

      restartButton.addEventListener('click', () => {
        if (state.level) {
          startQuiz(state.level);
        }
      });

      chooseButton.addEventListener('click', () => {
        resetUI();
        difficultyButtons.forEach((btn) => btn.classList.remove('active'));
      });

      difficultyButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const level = button.dataset.level;
          startQuiz(level);
        });
      });
    </script>
  </body>
</html>
